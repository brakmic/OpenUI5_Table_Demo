/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/ManagedObjectMetadata','./ASTUtils','./Doclet','sap/ui/demokit/js/esprima'],function(q,M,A,D,e){"use strict";var S=esprima.Syntax;var c;var I;var s;function g(n){if(n.type===S.MemberExpression){var i=g(n.object);return i?i+"."+n.property.name:null}else if(n.type===S.Identifier){return s[n.name]?s[n.name]:n.name}else{return null}}function a(n){return(n.type==S.CallExpression&&n.callee.type==S.MemberExpression&&g(n.callee)=="sap.ui.define")}function b(n){return(n.type==S.CallExpression&&n.callee.type==S.MemberExpression&&n.callee.property.type==S.Identifier&&n.callee.property.name=='extend'&&n.arguments.length>=2&&n.arguments[0].type==S.Literal&&typeof n.arguments[0].value=="string"&&A.unlend(n.arguments[1]).type==S.ObjectExpression)}function r(i){return/^\.\//.test(i)?c+i.slice(1):i}var d=A.createPropertyMap;var u=A.unlend;var f=M._guessSingularName;var h=D.get;var k=q.sap.log.error;var w=q.sap.log.warning;var v=q.sap.log.debug;function l(i,j){var x=g(i.callee.object);var C={metatype:'control',name:i.arguments[0].value,baseType:x,doc:j&&(j.classdesc||j.description),deprecation:j&&j.deprecated,since:j&&j.since,experimental:j&&j.experimental,properties:{},aggregations:{},associations:{},events:{},methods:{}};function y(F,G,H){var J,n,K,L;J=F&&d(F.value);if(J){for(n in J){if(J.hasOwnProperty(n)){L=h(J[n]);K=d(J[n].value,G);if(K==null){k("no valid metadata for "+n+" (AST type '"+J[n].value.type+"')");continue}H(n,K,L,J[n])}}}}var z=u(i.arguments[1]);var B=d(z);if(B&&B.metadata&&B.metadata.value.type!==S.ObjectExpression){w("class metadata exists but can't be analyzed. It is not of type 'ObjectExpression', but a '"+B.metadata.value.type+"'.");return null}var E=B&&B.metadata&&d(B.metadata.value);if(E){v("  analyzing metadata for '"+C.name+"'");C["abstract"]=!!(E["abstract"]&&E["abstract"].value.value);C["final"]=!!(E["final"]&&E["final"].value.value);y(E.properties,"type",function(n,F,G){C.properties[n]={name:n,doc:G&&G.description,since:G&&G.since,deprecation:G&&G.deprecated,experimental:G&&G.experimental,visibility:(F.visibility&&F.visibility.value.value)||"public",type:F.type?F.type.value.value:"string",defaultValue:(F.defaultValue&&F.defaultValue.value.value!==null)?F.defaultValue.value.value:undefined,bindable:F.bindable?F.bindable.value.value==="bindable":false}});C.defaultAggregation=(E.defaultAggregation&&E.defaultAggregation.value.value)||undefined;y(E.aggregations,"type",function(n,F,G){C.aggregations[n]={name:n,doc:G&&G.description,deprecation:G&&G.deprecated,since:G&&G.since,experimental:G&&G.experimental,visibility:(F.visibility&&F.visibility.value.value)||"public",type:F.type?F.type.value.value:"sap.ui.core.Control",singularName:F.singularName?F.singularName.value.value:f(n),cardinality:(F.multiple&&!F.multiple.value.value)?"0..1":"0..n",bindable:F.bindable?F.bindable.value.value==="bindable":false}});y(E.associations,"type",function(n,F,G){C.associations[n]={name:n,doc:G&&G.description,deprecation:G&&G.deprecated,since:G&&G.since,experimental:G&&G.experimental,visibility:(F.visibility&&F.visibility.value.value)||"public",type:F.type?F.type.value.value:"sap.ui.core.Control",singularName:F.singularName?F.singularName.value.value:f(n),cardinality:(F.multiple&&F.multiple.value.value)?"0..n":"0..1"}});y(E.events,null,function(n,F,G){var H=C.events[n]={name:n,doc:G&&G.description,deprecation:G&&G.deprecated,since:G&&G.since,experimental:G&&G.experimental,allowPreventDefault:!!(F.allowPreventDefault&&F.allowPreventDefault.value.value),parameters:{}};y(F.parameters,null,function(J,K,L){H.parameters[J]={name:J,doc:L&&L.description,deprecation:L&&L.deprecated,since:L&&L.since,experimental:L&&L.experimental,type:K&&K.type?K.type.value.value:""}})})}return C}function m(n){var j=D.get(n);var x=g(n.expression.left);if(x&&j&&j.isPublic()){var T={metatype:"type",doc:undefined,deprecation:false,visibility:'public'};T.name=x;if(j){T.doc=j.description;T.deprecation=j.deprecation;T.since=j.since;T.experimental=j.experimental}var y=n.expression.right.properties||[];T.values={};for(var i=0;i<y.length;i++){var z=D.get(y[i]);var B=y[i].key;var C=y[i].value;var E={};if(B.type==S.Identifier){E.name=B.name}else if(B.type==S.Literal){E.name=B.value}else{throw new Error()}if(C.type==S.Literal){E.value=C.value}else{throw new Error()}if(z!=null){E.doc=z.description;E.deprecation=z.deprecation;E.since=z.since;E.experimental=z.experimental}T.values[E.name]=E}I.push(T)}}function o(n){var i=D.get(n);var j=n.expression.right.arguments[0].value;var x=A.createPropertyMap(n.expression.right.arguments[1]);var y=null;if(n.expression.right.arguments.length>2&&n.expression.right.arguments[2].type==S.CallExpression&&n.expression.right.arguments[2].callee.type==S.MemberExpression&&g(n.expression.right.arguments[2].callee)=="sap.ui.base.DataType.getType"&&n.expression.right.arguments[2].arguments.length>0&&n.expression.right.arguments[2].arguments[0].type==S.Literal){y=n.expression.right.arguments[2].arguments[0].value}if(j&&i&&i.isPublic()){var T={metatype:"type",doc:undefined,deprecation:false,visibility:'public'};T.name=j;if(i){T.doc=i.description;T.deprecation=i.deprecation;T.since=i.since;T.experimental=i.experimental}var z=x.defaultValue;if(z){T.defaultValue=z.value.value}var B=x.isValid;if(B&&B.value.type==S.FunctionExpression&&B.value.body&&B.value.body.body.length>0&&B.value.body.body[0].type==S.ReturnStatement&&B.value.body.body[0].argument.type==S.CallExpression&&B.value.body.body[0].argument.callee.type==S.MemberExpression&&B.value.body.body[0].argument.callee.object.type==S.Literal&&B.value.body.body[0].argument.callee.object.value instanceof RegExp){var C=B.value.body.body[0].argument.callee.object.value.source;if(/^\^\(.*\)\$$/.test(C)){C=C.slice(2,-2)}T.pattern=C}T.baseType=y;I.push(T)}}var p={"ExpressionStatement":function(n){if(a(n.expression)){var i=0;var x,y;if(i<n.expression.arguments.length&&n.expression.arguments[i].type===S.Literal){n.expression.arguments[i++].value}if(i<n.expression.arguments.length&&n.expression.arguments[i].type===S.ArrayExpression){x=n.expression.arguments[i++].elements}if(i<n.expression.arguments.length&&n.expression.arguments[i].type===S.FunctionExpression){y=n.expression.arguments[i++]}if(x&&y&&y.params){for(var j=0;j<x.length;j++){var z=x[j].type===S.Literal?r(x[j].value):null;var B=j<y.params.length?y.params[j].name:null;if(z&&B){s[B]=z.replace(/\//g,'.')}}}}if(n.expression.type==S.AssignmentExpression&&n.expression.right.type==S.ObjectExpression&&n.expression.left.type==S.MemberExpression){m(n)}if(n.expression.type===S.AssignmentExpression&&n.expression.right.type===S.CallExpression&&n.expression.right.callee.type===S.MemberExpression&&n.expression.right.callee.property.type===S.Identifier&&n.expression.right.callee.property.name==='createType'&&g(n.expression.right.callee.object)=='sap.ui.base.DataType'&&n.expression.right.arguments.length>=2&&n.expression.right.arguments[0].type===S.Literal&&n.expression.right.arguments[1].type===S.ObjectExpression){o(n)}if(b(n.expression)){var C=D.get(n)||D.get(n.expression);var E=l(n.expression,C);if(E){I.push(E)}}},"VariableDeclaration":function(n){if(n.declarations.length==1&&n.declarations[0].init&&b(n.declarations[0].init)){var i=D.get(n)||D.get(n.declarations[0]);var C=l(n.declarations[0].init,i);if(C){I.push(C)}}}};function t(j,E,n){c=n.split('/').slice(0,-1).join('/');I=[];s={};var x=esprima.parse(j,{comment:true,attachComment:true});A.visit(x,p);for(var i=0;i<I.length;i++){if(I[i].name===E){return I[i]}}return}return{analyze:t}},false);
